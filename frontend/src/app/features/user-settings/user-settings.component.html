<div class="user-settings-container">
  <h1><mat-icon>settings</mat-icon> User Settings</h1>

  <mat-tab-group>
    <!-- Telegram Notifications Tab -->
    <mat-tab label="Telegram Notifications">
      <div class="tab-content">
        <mat-card>
          <mat-card-header>
            <mat-card-title>
              <mat-icon>telegram</mat-icon>
              Telegram Bot Configuration
            </mat-card-title>
          </mat-card-header>

          <mat-card-content>
            <!-- Loading State -->
            <div *ngIf="isLoading" class="loading-container">
              <mat-spinner diameter="40"></mat-spinner>
              <p>Loading configuration...</p>
            </div>

            <!-- Configuration Status -->
            <div *ngIf="!isLoading && telegramConfig" class="config-status">
              <div class="status-badge" [class.configured]="telegramConfig.is_configured">
                <mat-icon>{{ telegramConfig.is_configured ? 'check_circle' : 'info' }}</mat-icon>
                <span>{{ telegramConfig.is_configured ? 'Configured' : 'Not Configured' }}</span>
              </div>
              
              <div *ngIf="telegramConfig.is_configured" class="chat-id-display">
                <strong>Chat ID:</strong> {{ telegramConfig.chat_id }}
              </div>
            </div>

            <!-- Setup Instructions -->
            <div class="setup-instructions" *ngIf="!telegramConfig?.is_configured || showTokenInput">
              <h3>üì± How to Set Up Telegram Notifications</h3>
              <ol>
                <li>
                  Open Telegram and search for <strong>&#64;BotFather</strong>
                  <a href="https://t.me/botfather" target="_blank" mat-button color="primary">
                    <mat-icon>open_in_new</mat-icon> Open BotFather
                  </a>
                </li>
                <li>Send the command: <code>/newbot</code></li>
                <li>Follow the instructions to create your bot</li>
                <li>Copy the <strong>bot token</strong> (looks like <code>123456:ABC-DEF...</code>)</li>
                <li>
                  Search for <strong>&#64;userinfobot</strong> to get your Chat ID
                  <a href="https://t.me/userinfobot" target="_blank" mat-button color="primary">
                    <mat-icon>open_in_new</mat-icon> Get Chat ID
                  </a>
                </li>
                <li>Paste both below and test the connection</li>
              </ol>
            </div>

            <!-- Configuration Form -->
            <div class="config-form" *ngIf="!telegramConfig?.is_configured || showTokenInput">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Bot Token</mat-label>
                <input matInput 
                       type="password" 
                       [(ngModel)]="botToken" 
                       placeholder="123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11"
                       [disabled]="isTesting || isSaving">
                <mat-icon matPrefix>key</mat-icon>
                <mat-hint>Token from &#64;BotFather</mat-hint>
              </mat-form-field>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Chat ID</mat-label>
                <input matInput 
                       [(ngModel)]="chatId" 
                       placeholder="123456789"
                       [disabled]="isTesting || isSaving">
                <mat-icon matPrefix>chat</mat-icon>
                <mat-hint>Your Telegram Chat ID from &#64;userinfobot</mat-hint>
              </mat-form-field>

              <div class="button-group">
                <button mat-raised-button 
                        color="accent" 
                        (click)="testConnection()" 
                        [disabled]="isTesting || isSaving || !botToken || !chatId">
                  <mat-icon *ngIf="!isTesting">send</mat-icon>
                  <mat-spinner *ngIf="isTesting" diameter="20"></mat-spinner>
                  {{ isTesting ? 'Testing...' : 'Test Connection' }}
                </button>

                <button mat-raised-button 
                        color="primary" 
                        (click)="saveTelegramConfig()" 
                        [disabled]="isTesting || isSaving || !botToken || !chatId">
                  <mat-icon *ngIf="!isSaving">save</mat-icon>
                  <mat-spinner *ngIf="isSaving" diameter="20"></mat-spinner>
                  {{ isSaving ? 'Saving...' : 'Save Configuration' }}
                </button>

                <button mat-button 
                        *ngIf="telegramConfig?.is_configured"
                        (click)="toggleTokenInput()">
                  <mat-icon>cancel</mat-icon>
                  Cancel
                </button>
              </div>
            </div>

            <!-- Configured Actions -->
            <div class="configured-actions" *ngIf="telegramConfig?.is_configured && !showTokenInput">
              <button mat-raised-button color="primary" (click)="toggleTokenInput()">
                <mat-icon>edit</mat-icon>
                Update Configuration
              </button>

              <button mat-raised-button 
                      color="warn" 
                      (click)="deleteTelegramConfig()" 
                      [disabled]="isDeleting">
                <mat-icon *ngIf="!isDeleting">delete</mat-icon>
                <mat-spinner *ngIf="isDeleting" diameter="20"></mat-spinner>
                {{ isDeleting ? 'Removing...' : 'Remove Configuration' }}
              </button>
            </div>

            <!-- Info Box -->
            <div class="info-box">
              <mat-icon>info</mat-icon>
              <div>
                <h4>üì¢ About Notifications</h4>
                <p>Once configured, you can enable notifications per pipeline in the pipeline settings. You'll receive alerts for:</p>
                <ul>
                  <li>‚úÖ Trade executions</li>
                  <li>üí∞ Position closures with P&L</li>
                  <li>‚ö†Ô∏è Risk manager rejections</li>
                  <li>‚ùå Pipeline failures</li>
                </ul>
                <p><strong>Free forever!</strong> You control your own bot, no rate limits.</p>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-tab>

    <!-- Other Settings Tabs (Future) -->
    <mat-tab label="Profile">
      <div class="tab-content">
        <mat-card>
          <mat-card-content>
            <p>Profile settings coming soon...</p>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-tab>

    <mat-tab label="Subscription">
      <div class="tab-content">
        <mat-card>
          <mat-card-content>
            <p>Subscription management coming soon...</p>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>
